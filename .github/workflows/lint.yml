# Main Lint Workflow
#
# Runs generic linting checks that apply across the entire repository.
# Language-specific linting is handled in per-service workflows.

name: Lint

on:
  push:
    branches: [main]
    paths:
      - '.github/**'
      - '**.md'
      - '**.yml'
      - '**.yaml'
      - '**.json'
      - '.pre-commit-config.yaml'
      - '.prettierrc'
      - '.editorconfig'
  pull_request:
    branches: [main]
    paths:
      - '.github/**'
      - '**.md'
      - '**.yml'
      - '**.yaml'
      - '**.json'
      - '.pre-commit-config.yaml'
      - '.prettierrc'
      - '.editorconfig'

jobs:
  actionlint:
    name: Lint GitHub Actions
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Run actionlint
        uses: raven-actions/actionlint@963d4779ef039e217e5d0e6fd73ce9ab7764e493 # v2.1.0
        with:
          fail-on-error: true

  markdown:
    name: Lint Markdown
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Run markdownlint
        uses: DavidAnson/markdownlint-cli2-action@07035fd053f7be764496c0f8d8f9f41f98305101 # v22.0.0
        with:
          globs: |
            **/*.md
            !.beads/**

  prettier:
    name: Check Formatting (Prettier)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Set up Node.js
        uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
        with:
          node-version: '20'

      - name: Install Prettier
        run: npm install -g prettier

      - name: Check formatting
        run: prettier --check "**/*.{json,yml,yaml}" --ignore-path .prettierignore

  yaml-lint:
    name: Lint YAML
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Run yamllint
        uses: ibiqlik/action-yamllint@2576378a8e339169678f9939646ee3ee325e845c # v3.1.1
        with:
          file_or_dir: .
          config_data: |
            extends: default
            rules:
              line-length:
                max: 120
              truthy:
                check-keys: false
              document-start: disable
            ignore: |
              .beads/
              node_modules/
              vendor/
